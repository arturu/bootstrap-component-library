
{% spaceless %}

{# 
Mockups:
First Trasys mockups: https://projects.invisionapp.com/d/main/#/console/21247864/448353622/preview
Latest FE team mockups: https://www.figma.com/file/rF48zjlWNsBf0cqJWc9PpU/Wireframes?node-id=176%3A784 
Jira task with some comments to consider: https://citnet.tech.ec.europa.eu/CITnet/jira/browse/ISAICP-6415?page=com.atlassian.jira.plugin.system.issuetabpanels%3Aall-tabpanel
#}

{# Parameters:
  - breakpoint (string) (default: 'md')
    options: ['', 'xs', 'sm', 'md', 'lg', 'xl']
  - brand (object) (default: {})
    format: {
      src: '',
      alt: '',
      motto: '', (optional)
      link: ''
    }
  - collapse_id (string) (default: '')
  - list_id (string) (default: '')
  - anchors (array of objects) (default: [{}])
    format: [{
      link: '',
      label: '',
      extra_attributes: '' (optional: for example 'target="_blank" rel="noopener"')
    }]
  - buttons (array of objects) (default: [{}])
    format: [{
      id: '',
      label: '',
      icon: '',
      type: '', (options: ['teaser', 'notifications', 'links'])
      amount: '',
      teaser: (object)
      format: {
        title: '',
        text: '',
        cta: {
          link: '',
          label: ''
        }
      },
      notifications: (array of objects)
      format: [{
        title: '',
        text: '',
        days_ago: '',
        unread: , (boolean)
      }]
      mark_all_as_read: '',
      days_ago: '',
      see_all: '',
      links: (array of objects)
      format: [{
        link: '',
        label: '',
        extra_classes: '',
        separator: , (boolean)
      }]
    }]
#}
{% set _breakpoint = breakpoint|default('') %}
{% set _brand = brand|default({}) %}
{% set _collapse_id = collapse_id|default('') %}
{% set _list_id = list_id|default('') %}
{% set _anchors = anchors|default([{}]) %}
{% set _buttons = buttons|default([{}]) %}

{% set _nav_classes = ['navbar', 'joinup-navbar'] %}
{% set _navbar_toggler_classes = ['navbar-toggler'] %}
{% set _list_classes = ['navbar-nav', 'accordion', 'accordion-flush'] %}
{% set _list_id = list_id|default('accordion-1') %}
{% if _breakpoint is not empty %}
  {% set _nav_classes = _nav_classes|merge(['navbar-expand-' ~ _breakpoint]) %}
{% else %}
  {% set _nav_classes = _nav_classes|merge(['navbar-expand']) %}
{% endif %}

{% if nav_attributes is empty %}
  {% set nav_attributes = create_attribute() %}
{% endif %}

{% if navbar_toggler_attributes is empty %}
  {% set navbar_toggler_attributes = create_attribute() %}
{% endif %}

{% if list_attributes is empty %}
  {% set list_attributes = create_attribute() %}
{% endif %}

{% set nav_attributes = nav_attributes.addClass(_nav_classes) %}
{% set navbar_toggler_attributes = navbar_toggler_attributes.addClass(_navbar_toggler_classes) %}
{% set navbar_toggler_attributes = navbar_toggler_attributes.setAttribute('type', 'button') %}
{% set navbar_toggler_attributes = navbar_toggler_attributes.setAttribute('data-bs-toggle', 'collapse') %}
{% set navbar_toggler_attributes = navbar_toggler_attributes.setAttribute('data-bs-target', '#' ~ _collapse_id) %}
{% set navbar_toggler_attributes = navbar_toggler_attributes.setAttribute('aria-controls', _collapse_id) %}
{% set navbar_toggler_attributes = navbar_toggler_attributes.setAttribute('aria-expanded', 'false') %}
{% set navbar_toggler_attributes = navbar_toggler_attributes.setAttribute('aria-label', 'Toggle navigation') %}
{% set list_attributes = list_attributes.addClass(_list_classes) %}
{% set list_attributes = list_attributes.setAttribute('id', _list_id) %}

<nav 
  {{ nav_attributes }}
>
  <div class="container">
    <a class="navbar-brand" href="{{ _brand.link }}">
      <img src="{{ _brand.src }}" alt="{{ _brand.alt }}" />
    </a>
    {% if _brand.motto is not empty %}
      <span class="navbar-motto">{{ _brand.motto }}</span>
    {% endif %}
    {% if _breakpoint is not empty %}
      <button
        {{ navbar_toggler_attributes }}
      >
        <span class="navbar-toggler-icon"></span>
      </button>
    {% endif %}
    <div class="collapse navbar-collapse" id="{{ _collapse_id }}">
      <ul 
        {{ list_attributes }}
      >
        {% for anchor in _anchors %}
          <li class="nav-item">
            <a class="nav-link" href="{{ anchor.link }}" {{ anchor.extra_attributes}}>{{ anchor.label }}</a>
          </li>
        {% endfor %}
        {% for button in _buttons %}
          <li class="nav-item accordion-item">
            <span class="accordion-header" id="heading-{{ button.id }}">
              <button
                class="accordion-button nav-link"
                data-bs-toggle="collapse"
                autocomplete="off"
                data-bs-target="#collapse-{{ button.id }}"
                aria-controls="collapse-{{ button.id }}"
                aria-expanded="false"
                type="button"
              >
                {% if button.icon is not empty %}
                  {%- include '@oe-bcl/bcl-icon/icon.html.twig' with button.icon only -%}
                  {% if button.amount is not empty %}
                    <span class="accordion-button-counter">{{ button.amount }}</span>
                  {% endif %}
                {% endif %}
                {% if button.label is not empty %}
                  <span class="accordion-button-label">{{ button.label }}</span>
                {% endif %}
              </button>
            </span>
            <div 
              id="collapse-{{ button.id }}"
              class="accordion-collapse collapse"
              aria-labelledby="heading-{{ button.id }}"
              data-bs-parent="#{{ _collapse_id }}"
              >
              <div class="accordion-body">
                {% if button.type == 'teaser' %}
                  <p class="ju-navbar__accordion-title">
                    {{ button.teaser.title }}
                  </p>
                  <p class="ju-navbar__accordion-text">
                    {{ button.teaser.text }}
                  </p>
                  <p class="ju-navbar__accordion-cta">
                    <a class="ju-navbar__accordion-cta-link" href="{{ button.teaser.cta.link }}">
                      {{ button.teaser.cta.label }}
                      {%- include '@oe-bcl/bcl-icon/icon.html.twig' with {
                        name: "arrow-right-short",
                        path: "static/media/bootstrap/bootstrap-icons.svg",
                      } only -%}
                    </a>
                  </p>
                {% elseif button.type == 'notifications' %}
                  <button type="button" class="ju-navbar__accordion-mark">
                    {{ button.mark_all_as_read }}
                  </button>
                  <ul class="ju-navbar__accordion-list">
                    {% for notification in button.notifications %}
                      {% if notification.unread %}
                        <li class="ju-navbar__accordion-list-item ju-navbar__accordion-list-item--unread">
                      {% else %}
                        <li class="ju-navbar__accordion-list-item">
                      {% endif %}
                        <a href="#" class="ju-navbar__accordion-list-link">
                          <article class="ju-navbar__accordion-list-notif">
                            <p class="ju-navbar__accordion-list-notif-title">{{ notification.title }}</p>
                            <p class="ju-navbar__accordion-list-notif-text">{{ notification.text }}</p>
                            <p class="ju-navbar__accordion-list-notif-date">{{ notification.days_ago }}{{ button.days_ago }}</p>
                          </article>
                        </a>
                      </li>
                    {% endfor %}
                  </ul>
                  <a class="ju-navbar__accordion-all" href="{{ button.see_all.link }}">
                    {{ button.see_all.label }}
                    {%- include '@oe-bcl/bcl-icon/icon.html.twig' with {
                      name: "arrow-right-short",
                      path: "static/media/bootstrap/bootstrap-icons.svg",
                    } only -%}
                  </a>
                {% elseif button.type == 'links' %}
                  <ul class="ju-navbar__accordion-list">
                    {% for link in button.links %}
                      {% if link.separator %}
                        <li class="ju-navbar__accordion-list-item"><hr class="dropdown-divider" /></li>
                      {% else %}
                        <li class="ju-navbar__accordion-list-item">
                          <a href="{{ link.link }}" class="ju-navbar__accordion-list-link">
                            {{ link.label }}
                          </a>
                        </li>
                      {% endif %}
                    {% endfor %}
                  </ul>
                {% endif %}
              </div>
            </div>
          </li>
        {% endfor %}
      </ul>
    </div>
  </div>
</nav>
{% endspaceless %}